---
title: "How I Built a 4TB Encrypted Portable Pentest Drive (Part 1: Architecture & Threat Model)"
date: 2025-06-02
layout: blog
series: ["Portable Pentest Drive"]
draft: false
---

## Why Carry a Full Pentest Platform?

Offensive security work is mobile by nature â€” sometimes you're on-site, sometimes remote, sometimes jumping between clients, machines, or even air-gapped setups. Cloud-hosted platforms introduce risk, and carrying a laptop for every use case is overkill. I wanted a drive that could:

- Store my persistent **Kali VM**
- Archive all my **sessions, notes, and tools**
- Boot **a live Kali system** if needed
- Sync logs between **Windows, Linux, Mac**
- Stay **fully encrypted**, stealthy, and usable on the move

So I turned a 4TB external SSD into a **multi-partition hacker platform**.
Hereâ€™s how I built it.

## Partition Layout

| Partition | Format     | Purpose |
|-----------|------------|---------|
| `/dev/sdX1` | `exFAT`     | Shared storage for screenshots, notes, small loot |
| `/dev/sdX2` | `LUKS + ext4` | Encrypted storage: VMs, ops data, tools, backups |
| `/dev/sdX3` | `ext4 (GRUB)` | Bootloader partition with GRUB
| `/dev/sdX4` | `LUKS + ext4` | Full encrypted Kali install (permanant OS)

## Encrypting the Shared Vault Partiton (sdx2)

### 1. Create the encrypted volume
```bash
sudo cryptsetup luksFormat /dev/sdX2
```

### 2. Open and format it

```bash
sudo cryptsetup open --key-file=/home/<user>/keys/usb.key /dev/sdX2 secureusb
sudo mkfs.ext4 /dev/mapper/secureusb
```

### 3. Mount it

```bash
mkdir -p ~/secureusb
sudo mount /dev/mapper/secureusb ~/secureusb
```

## GPG-Based Unlocking (On Trusted Machines)

Instead of storing a plaintext keyfile, each of my secure machines has a GPG encrypted key, which is decrypted in memory only when needed.  The exception is my portable Kali doesn't need the GPG side of things as it's completely secure at boot with only a single user account (my attack login).

### Setting up the keyfile

You can create a keyfile to unlock the drive without typing a password.

```bash
dd if=/dev/urandom of=~/.keys/usb.key bs=1024 count=4
chmod 600 ~/.keys/usb.key
sudo cryptsetup luksAddKey /dev/sdX2 ~/.keys/usb.key
```

then to open the drive you simply pass the key

```bash
cryptsetup oepn --key-file=/home/<user>/.keys/usb.key
```

but this means anyone on your machine with root access can access this file so I encrypted using my GPG key which is managed by my gnome keyring which unlocks upon my login.

```bash
gpg --quiet --batch --decrypt ~/.keys/usb.key.gpg > /tmp/usb.key
cryptsetup open --key-file=/tmp/usb.key /dev/sdX2 ~/secureusb
scrub -u /tmp/usb.key
```

### Sharing GPG
I didn't want to maintain separate GPG identities across machines.  Instead, I exported my public/private keypair to a secure USB, imported it on each trusted host, and then scrubbed private keys from the USB post-import:

```bash
gpg --export-secret-keys <keyid> > portable.key
# import on new machine
gpg --import portable.key
# scrub from USB
shred -u portable.key
```

This way, I retain a single GPG identity across my environments.  Just make sure you shred your key as soon as it's imported just incase you misplace that pendrive.


## Shared exFAT Partition

This is an unencrypted share that is deliberate to allow for portability when not needing my full encrypted system for protection.  For everyday personal files or non-sensitive transfers.

For compatibility:

* /dev/sdX1 is exFAT
* Mountable on Linux, Windows, Mac
* Use for low-risk transfer files (e.g., screenshots, drop reports, blog drafts)

## Hosting My Kali VM

I keep my .vbox, .vdi, and session folders directly on the encrypted partition:
```bash
/mnt/kaliusb/
â”œâ”€â”€ vm/
â”‚   â””â”€â”€ Kali-Ghost.vbox
â”œâ”€â”€ ops/
â”‚   â”œâ”€â”€ sessions/
â”‚   â””â”€â”€ tools/
â””â”€â”€ backups/
```

I'll cover more of this setup will be in a future post.

This means:
* My VM is portable
* All sessions are persistent, encrypted
* No trace remains on the host

## Bootable Partition

I made `/dev/sdX3` a standalone boot partition. It contains a permemnant GRUB installation that loads the encrypted Kali OS from `/dev/sdX4`

* Works on any x86 machine. Bring your OS with you.

## Encrypted Kali instance

The fourth partition `/dev/sdX4` contains a full encrypted Kali Linux install.  It is unlocked at boot by GRUB (from `/dev/sdX3`) and drops me into a single user attack environment.  This OS binds `~/secureusb` the same way my VM does, so my session data is always available -- whether I'm running Kali in VirtualBox or booting it natively from the drive.


## Why This Setup Works

- ğŸ” Portable across machines
- ğŸ”’ Fully encrypted, stealthy, and isolated
- ğŸ’» Bootable when needed
- ğŸ”„ Compatible with Linux, Mac, Windows
- ğŸ§  Nothing decrypts unless I unlock it
- ğŸ§³ Minimal footprint

I donâ€™t need a cloud VM. I donâ€™t need a platform. I just need my drive and a USB port.

## Final Thought

If you want to carry your entire pentest world on a drive â€” not just tools, but your identity, session history, and kill switch â€” this is the cleanest way to do it.

Let them keep their cloud labs.
Iâ€™ve got a 4TB ghost system that follows me only when I want it to and ensures:

* My data stays encrypted unless I unlock it
* My ops data is always segregated
* My host machine is just a launcher

## Coming Up in the Series

1. **Part 2:** Building and partitioning the drive (bootloader, Kali install, encryption)
2. **Part 3:** Automation scripts for trusted machines and portable boot
3. **Part 4:** Folder layout, bind mounts, and VM sync strategy
